<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î™©Ìè¨ Ïó¨Ìñâ ÌîåÎûòÎÑà</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, updateDoc, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyB-jh8Zh-Bz7_pzX1D0joM8hdO3ff_o0zE",
            authDomain: "mokpo-trip.firebaseapp.com",
            projectId: "mokpo-trip",
            storageBucket: "mokpo-trip.firebasestorage.app",
            messagingSenderId: "348087301528",
            appId: "1:348087301528:web:98172e0a1395fc11f6a7ed",
            measurementId: "G-FPW97886QJ"
        };
        
        const app = initializeApp(firebaseConfig);
        window.db = getFirestore(app);
        window.firestore = { collection, addDoc, onSnapshot, deleteDoc, doc, updateDoc, query, orderBy };
    </script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        @keyframes bounce {
            0%, 100% {
                transform: translateY(-25%);
                animation-timing-function: cubic-bezier(0.8, 0, 1, 1);
            }
            50% {
                transform: translateY(0);
                animation-timing-function: cubic-bezier(0, 0, 0.2, 1);
            }
        }
        .animate-bounce {
            animation: bounce 1s infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Lucide Icons
        const Plus = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>;
        const X = ({size = 24}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
        const CheckSquare = ({size = 24}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 11 12 14 22 4"></polyline><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>;
        const Calendar = ({size = 24, strokeWidth = 2}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>;
        const Wallet = ({size = 24, strokeWidth = 2}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round"><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"></path><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"></path><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"></path></svg>;
        const Sparkles = ({size = 24, strokeWidth = 2}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path><path d="M5 3v4"></path><path d="M19 17v4"></path><path d="M3 5h4"></path><path d="M17 19h4"></path></svg>;
        const Send = ({size = 24}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>;
        const Utensils = ({size = 24}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"></path><path d="M7 2v20"></path><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"></path></svg>;
        const Coffee = ({size = 24}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 8h1a4 4 0 1 1 0 8h-1"></path><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"></path><line x1="6" y1="2" x2="6" y2="4"></line><line x1="10" y1="2" x2="10" y2="4"></line><line x1="14" y1="2" x2="14" y2="4"></line></svg>;
        const Car = ({size = 24}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"></path><circle cx="7" cy="17" r="2"></circle><path d="M9 17h6"></path><circle cx="17" cy="17" r="2"></circle></svg>;
        const ShoppingBag = ({size = 24}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>;
        const Bed = ({size = 24}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 4v16"></path><path d="M2 8h18a2 2 0 0 1 2 2v10"></path><path d="M2 17h20"></path><path d="M6 8v9"></path></svg>;
        const Loader2 = () => <svg className="animate-spin" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"></path></svg>;
        const Users = ({size = 20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M22 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>;

        const COLORS = {
            bg: '#FFFCF7',
            greenDeep: '#2F6352',
            greenLeaf: '#5F8575',
            greenSoft: '#98B092',
            terra: '#E07D54',
            gold: '#FFE1A0',
        };

        const fetchGeminiResponse = async (prompt) => {
            const apiKey = "AIzaSyD7FdJZEGMNa7EsxGvK6f2dPq6tKxSBfro";
            try {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }]
                        })
                    }
                );
                if (!response.ok) throw new Error('API Error');
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "";
            } catch (error) {
                console.error("Gemini API Error:", error);
                return null;
            }
        };

        const TimelineTab = () => {
            const [events, setEvents] = useState([]);
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [inputText, setInputText] = useState('');
            const [deleteTarget, setDeleteTarget] = useState(null);

            useEffect(() => {
                const unsubscribe = window.firestore.onSnapshot(
                    window.firestore.collection(window.db, 'timeline'),
                    (snapshot) => {
                        const eventsData = snapshot.docs.map(doc => ({
                            firestoreId: doc.id,
                            ...doc.data()
                        }));
                        setEvents(eventsData);
                    }
                );
                return () => unsubscribe();
            }, []);

            const handleAdd = async () => {
                if (!inputText.trim()) return;
                const parts = inputText.split(/[\/|]/);
                let time = 'Time Unset';
                let content = inputText;
                
                if (parts.length >= 2) {
                    time = parts[0].trim();
                    content = parts[1].trim();
                }

                let emoji = 'üìå';
                let theme = 'nature';
                
                if (content.includes('Î™©Ìè¨') || content.includes('Î≤ÑÏä§') || content.includes('Ï∂úÎ∞ú')) { emoji = 'üöå'; theme = 'warm'; }
                else if (content.includes('Î∞îÎã§')) { emoji = 'üåä'; theme = 'nature'; }
                else if (content.includes('ÏãùÏÇ¨') || content.includes('ÎßõÏßë')) { emoji = 'üç±'; theme = 'warm'; }
                else if (content.includes('Ïπ¥Ìéò') || content.includes('Ïª§Ìîº')) { emoji = '‚òï'; theme = 'nature'; }
                else if (content.includes('ÏàôÏÜå') || content.includes('Ìò∏ÌÖî')) { emoji = 'üè†'; theme = 'nature'; }

                await window.firestore.addDoc(window.firestore.collection(window.db, 'timeline'), {
                    time, content, emoji, theme, createdAt: Date.now()
                });
                
                setInputText('');
                setIsModalOpen(false);
            };

            const handleDelete = async () => {
                if (deleteTarget) {
                    await window.firestore.deleteDoc(window.firestore.doc(window.db, 'timeline', deleteTarget));
                    setDeleteTarget(null);
                }
            };

            const sortedEvents = [...events].sort((a, b) => a.time.localeCompare(b.time));

            return (
                <div className="h-full flex flex-col relative overflow-hidden bg-[#FFFCF7]">
                    <div className="flex justify-between items-center mt-8 ml-6 mr-6 mb-4">
                        <h1 className="text-4xl font-black text-black z-10 tracking-tighter">TIMELINE</h1>
                        <div className="flex items-center gap-2 bg-green-100 px-3 py-1 rounded-full">
                            <Users size={16} />
                            <span className="text-xs font-bold text-green-800">Ïã§ÏãúÍ∞Ñ Í≥µÏú†Ï§ë</span>
                        </div>
                    </div>
                    
                    <div className="flex-1 overflow-x-auto overflow-y-hidden flex items-center px-10 gap-8 pb-20 scrollbar-hide">
                        <div className="flex-shrink-0 w-32 h-32 rounded-full border-4 border-white shadow-xl flex flex-col justify-center items-center text-center relative z-10"
                            style={{ backgroundColor: COLORS.greenDeep }}>
                            <span className="absolute -top-8 text-lg font-bold" style={{ color: COLORS.greenDeep }}>14:00</span>
                            <span className="text-white font-bold text-lg mt-1">U-SQUARE</span>
                            <span className="text-white text-xs font-light opacity-80">Start Point</span>
                            <span className="absolute -bottom-8 text-xs font-bold tracking-widest" style={{ color: COLORS.greenLeaf }}>START</span>
                        </div>

                        {sortedEvents.map((evt) => (
                            <div key={evt.firestoreId} 
                                className="flex-shrink-0 relative group min-w-[160px] h-[100px] rounded-3xl flex flex-col justify-center items-center p-4 border-2 shadow-sm transition-all hover:scale-105"
                                style={{ 
                                    backgroundColor: evt.theme === 'warm' ? COLORS.terra : COLORS.greenLeaf,
                                    borderColor: evt.theme === 'warm' ? COLORS.gold : 'white',
                                    color: 'white'
                                }}>
                                <button onClick={() => setDeleteTarget(evt.firestoreId)} 
                                        className="absolute -top-3 -right-3 w-6 h-6 bg-red-500 rounded-full text-white flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity border-2 border-white shadow-md">
                                    <X size={14} />
                                </button>
                                <span className="text-xs font-bold mb-1 opacity-90" style={{ color: evt.theme === 'warm' ? COLORS.gold : '#E8F5E9' }}>{evt.time}</span>
                                <span className="font-bold text-center flex items-center gap-1">{evt.emoji} {evt.content}</span>
                            </div>
                        ))}
                        <div className="absolute top-1/2 left-0 w-full h-1 bg-gray-200 -z-0 transform translate-y-4" />
                    </div>

                    <button onClick={() => setIsModalOpen(true)}
                            className="absolute bottom-6 right-6 w-14 h-14 rounded-full shadow-lg flex items-center justify-center text-white text-3xl transition-transform hover:scale-110 hover:rotate-90 z-50"
                            style={{ backgroundColor: COLORS.greenDeep }}>
                        <Plus />
                    </button>

                    {isModalOpen && (
                        <div className="absolute inset-0 bg-black/40 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-white w-full max-w-sm rounded-2xl p-6 shadow-2xl">
                                <h3 className="text-lg font-bold mb-4" style={{ color: COLORS.greenDeep }}>ÏùºÏ†ï Ï∂îÍ∞Ä</h3>
                                <div className="mb-4">
                                    <label className="block text-xs text-gray-500 mb-1">ÏãúÍ∞Ñ / ÎÇ¥Ïö©</label>
                                    <input type="text" value={inputText} onChange={(e) => setInputText(e.target.value)}
                                        placeholder="Ïòà: 15:30 / Î™©Ìè¨Ïó≠ ÎèÑÏ∞©"
                                        className="w-full p-3 border-2 border-gray-100 rounded-xl focus:outline-none focus:border-[#2F6352]"
                                        onKeyPress={(e) => e.key === 'Enter' && handleAdd()} />
                                </div>
                                <div className="flex justify-end gap-2">
                                    <button onClick={() => setIsModalOpen(false)} className="px-4 py-2 bg-gray-100 rounded-lg text-gray-600 font-medium">Ï∑®ÏÜå</button>
                                    <button onClick={handleAdd} className="px-4 py-2 text-white rounded-lg font-medium" style={{ backgroundColor: COLORS.greenDeep }}>Ï∂îÍ∞Ä</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {deleteTarget && (
                        <div className="absolute inset-0 bg-black/40 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-white w-full max-w-xs rounded-2xl p-6 shadow-2xl text-center">
                                <p className="mb-6 font-bold text-gray-800">Ïù¥ ÏùºÏ†ïÏùÑ ÏÇ≠Ï†úÌï†ÍπåÏöî?</p>
                                <div className="flex justify-center gap-3">
                                    <button onClick={() => setDeleteTarget(null)} className="px-4 py-2 bg-gray-100 rounded-lg text-gray-600">Ï∑®ÏÜå</button>
                                    <button onClick={handleDelete} className="px-4 py-2 bg-red-500 text-white rounded-lg">ÏÇ≠Ï†ú</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const ChecklistTab = () => {
            const [tasks, setTasks] = useState([]);
            const [inputText, setInputText] = useState('');
            const [deleteTarget, setDeleteTarget] = useState(null);
            const [isAiLoading, setIsAiLoading] = useState(false);

            useEffect(() => {
                const unsubscribe = window.firestore.onSnapshot(
                    window.firestore.collection(window.db, 'checklist'),
                    (snapshot) => {
                        const tasksData = snapshot.docs.map(doc => ({
                            firestoreId: doc.id,
                            ...doc.data()
                        }));
                        setTasks(tasksData);
                    }
                );
                return () => unsubscribe();
            }, []);

            const addTask = async (text) => {
                const val = text || inputText;
                if (!val.trim()) return;
                await window.firestore.addDoc(window.firestore.collection(window.db, 'checklist'), {
                    text: val.trim(),
                    completed: false,
                    createdAt: Date.now()
                });
                if (!text) setInputText('');
            };

            const toggleTask = async (firestoreId, completed) => {
                await window.firestore.updateDoc(
                    window.firestore.doc(window.db, 'checklist', firestoreId),
                    { completed: !completed }
                );
            };

            const handleDelete = async () => {
                if (deleteTarget) {
                    await window.firestore.deleteDoc(window.firestore.doc(window.db, 'checklist', deleteTarget));
                    setDeleteTarget(null);
                }
            };

            const handleAiSuggest = async () => {
                setIsAiLoading(true);
                const prompt = "Î™©Ìè¨ Ïó¨ÌñâÏóê ÌïÑÏöîÌïú ÌïÑÏàò Ï§ÄÎπÑÎ¨º 3Í∞ÄÏßÄÎßå Îã®Ïñ¥ ÌòïÌÉúÎ°ú Ï∂îÏ≤úÌï¥Ï§ò. ÏΩ§Îßà(,)Î°ú Íµ¨Î∂ÑÌï¥ÏÑú ÏïåÎ†§Ï§ò. (Ïòà: ÏÑ†Í∏ÄÎùºÏä§, Ïπ¥Î©îÎùº, Ìé∏Ìïú Ïã†Î∞ú)";
                const result = await fetchGeminiResponse(prompt);
                
                if (result) {
                    const suggestions = result.split(',').map(s => s.trim());
                    for (const item of suggestions) {
                        await window.firestore.addDoc(window.firestore.collection(window.db, 'checklist'), {
                            text: item,
                            completed: false,
                            createdAt: Date.now()
                        });
                    }
                }
                setIsAiLoading(false);
            };

            return (
                <div className="h-full flex flex-col relative overflow-hidden" style={{ backgroundColor: '#FFFCF7' }}>
                    <div className="absolute inset-0 z-0 pointer-events-none opacity-60">
                        <div className="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] rounded-full mix-blend-multiply filter blur-3xl animate-pulse" style={{ background: COLORS.greenSoft }}></div>
                        <div className="absolute bottom-[-10%] right-[-10%] w-[60%] h-[60%] rounded-full mix-blend-multiply filter blur-3xl animate-pulse" style={{ background: COLORS.greenDeep, animationDelay: '2s' }}></div>
                        <div className="absolute top-[30%] left-[30%] w-[40%] h-[40%] rounded-full mix-blend-multiply filter blur-3xl animate-pulse" style={{ background: COLORS.greenLeaf, animationDelay: '4s' }}></div>
                    </div>

                    <div className="relative z-10 flex flex-col h-full p-6">
                        <div className="bg-white/80 backdrop-blur-xl rounded-[30px] shadow-xl border border-white/50 flex flex-col h-full overflow-hidden">
                            <div className="p-6 pb-2 flex flex-col gap-3">
                                <div className="flex items-center justify-between mb-2">
                                    <h2 className="text-xl font-bold" style={{ color: COLORS.greenDeep }}>Ï§ÄÎπÑÎ¨º Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏</h2>
                                    <div className="flex items-center gap-2 bg-green-100 px-3 py-1 rounded-full">
                                        <Users size={14} />
                                        <span className="text-xs font-bold text-green-800">Í≥µÏú†Ï§ë</span>
                                    </div>
                                </div>
                                <div className="flex gap-2">
                                    <input type="text" value={inputText} onChange={(e) => setInputText(e.target.value)}
                                        placeholder="Ï±ôÍ∏∏ Í≤É ÏßÅÏ†ë ÏûÖÎ†•"
                                        className="flex-1 p-4 rounded-2xl border-none bg-white shadow-sm focus:ring-2 focus:ring-[#2F6352] outline-none text-gray-800 placeholder-gray-400"
                                        onKeyPress={(e) => e.key === 'Enter' && addTask()} />
                                    <button onClick={() => addTask()} 
                                            className="w-14 h-14 rounded-2xl flex items-center justify-center text-white text-2xl shadow-md hover:scale-105 transition-transform"
                                            style={{ backgroundColor: COLORS.greenDeep }}>
                                        <Plus />
                                    </button>
                                </div>
                                
                                <button 
                                    onClick={handleAiSuggest}
                                    disabled={isAiLoading}
                                    className="w-full py-3 rounded-xl bg-gradient-to-r from-indigo-500 to-purple-500 text-white font-bold text-sm shadow-md flex items-center justify-center gap-2 hover:opacity-90 transition-opacity"
                                >
                                    {isAiLoading ? <Loader2 /> : <Sparkles size={16}/>}
                                    {isAiLoading ? "AIÍ∞Ä ÏÉùÍ∞Å Ï§ë..." : "AI Ï∂îÏ≤ú Ï§ÄÎπÑÎ¨º ÏûêÎèô Ï∂îÍ∞Ä"}
                                </button>
                            </div>

                            <div className="flex-1 overflow-y-auto px-6 pb-6 space-y-3">
                                {tasks.length === 0 && (
                                    <div className="text-center text-gray-400 mt-10 text-sm">Ï§ÄÎπÑÎ¨ºÏùÑ Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî üåø</div>
                                )}
                                {tasks.map(task => (
                                    <div key={task.firestoreId} className="bg-white/90 p-4 rounded-2xl flex items-center gap-4 shadow-sm group hover:shadow-md transition-all border border-transparent hover:border-[#98B092]">
                                        <button onClick={() => toggleTask(task.firestoreId, task.completed)}
                                                className={`w-6 h-6 rounded-full border-2 flex items-center justify-center transition-all ${task.completed ? 'bg-[#2F6352] border-[#2F6352]' : 'bg-white border-[#2F6352]'}`}>
                                            {task.completed && <CheckSquare size={14} className="text-white" />}
                                        </button>
                                        <span className={`flex-1 font-medium ${task.completed ? 'text-gray-400 line-through' : 'text-gray-800'}`}>{task.text}</span>
                                        <button onClick={() => setDeleteTarget(task.firestoreId)} className="text-gray-300 hover:text-[#E07D54] transition-colors">
                                            <X size={20} />
                                        </button>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>

                    {deleteTarget && (
                        <div className="absolute inset-0 bg-black/20 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <div className="bg-white p-6 rounded-2xl shadow-xl text-center border border-[#98B092]">
                                <p className="mb-4 font-bold text-gray-800">Ï†ïÎßê ÏÇ≠Ï†úÌï†ÍπåÏöî? üåø</p>
                                <div className="flex justify-center gap-2">
                                    <button onClick={() => setDeleteTarget(null)} className="px-4 py-2 bg-gray-100 rounded-xl text-gray-600">Ï∑®ÏÜå</button>
                                    <button onClick={handleDelete} className="px-4 py-2 bg-[#2F6352] text-white rounded-xl shadow-md">ÏÇ≠Ï†ú</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const BudgetTab = () => {
            const [expenses, setExpenses] = useState([]);
            const [newItem, setNewItem] = useState({ desc: '', amount: '', cat: 'food' });
            const [isAdding, setIsAdding] = useState(false);

            useEffect(() => {
                const unsubscribe = window.firestore.onSnapshot(
                    window.firestore.collection(window.db, 'budget'),
                    (snapshot) => {
                        const expensesData = snapshot.docs.map(doc => ({
                            firestoreId: doc.id,
                            ...doc.data()
                        }));
                        setExpenses(expensesData.sort((a, b) => b.createdAt - a.createdAt));
                    }
                );
                return () => unsubscribe();
            }, []);

            const addExpense = async () => {
                if (!newItem.desc || !newItem.amount) return;
                await window.firestore.addDoc(window.firestore.collection(window.db, 'budget'), {
                    desc: newItem.desc,
                    amount: parseInt(newItem.amount),
                    cat: newItem.cat,
                    date: new Date().toLocaleDateString(),
                    createdAt: Date.now()
                });
                setNewItem({ desc: '', amount: '', cat: 'food' });
                setIsAdding(false);
            };

            const deleteExpense = async (firestoreId) => {
                if (confirm('ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    await window.firestore.deleteDoc(window.firestore.doc(window.db, 'budget', firestoreId));
                }
            };

            const totalSpent = expenses.reduce((acc, curr) => acc + curr.amount, 0);

            const categories = [
                { id: 'food', label: 'ÏãùÎπÑ', icon: <Utensils size={16}/> },
                { id: 'cafe', label: 'Ïπ¥Ìéò', icon: <Coffee size={16}/> },
                { id: 'transport', label: 'ÍµêÌÜµ', icon: <Car size={16}/> },
                { id: 'shopping', label: 'ÏáºÌïë', icon: <ShoppingBag size={16}/> },
                { id: 'stay', label: 'ÏàôÎ∞ï', icon: <Bed size={16}/> },
            ];

            return (
                <div className="h-full flex flex-col bg-[#FDFBF6] relative">
                    <div className="p-6 bg-gradient-to-r from-[#2F6352] to-[#5F8575] text-white rounded-b-3xl shadow-lg mb-4">
                        <div className="flex justify-between items-center mb-2">
                            <h2 className="text-sm opacity-80 font-medium">Ï¥ù ÏßÄÏ∂ú Í∏àÏï°</h2>
                            <div className="flex items-center gap-1 bg-white/20 px-2 py-1 rounded-full">
                                <Users size={12} />
                                <span className="text-xs font-bold">Í≥µÏú†Ï§ë</span>
                            </div>
                        </div>
                        <div className="flex items-baseline gap-1">
                            <span className="text-4xl font-black tracking-tight">{totalSpent.toLocaleString()}</span>
                            <span className="text-lg">Ïõê</span>
                        </div>
                    </div>

                    <div className="flex-1 overflow-y-auto px-6 pb-24">
                        {!isAdding ? (
                            <button onClick={() => setIsAdding(true)} 
                                    className="w-full py-3 bg-white border-2 border-dashed border-[#2F6352]/30 text-[#2F6352] rounded-xl font-bold mb-4 hover:bg-[#2F6352]/5 transition-colors flex items-center justify-center gap-2">
                                <Plus size={20} /> ÏßÄÏ∂ú ÎÇ¥Ïó≠ Ï∂îÍ∞Ä
                            </button>
                        ) : (
                            <div className="bg-white p-4 rounded-xl shadow-md border border-[#2F6352]/20 mb-4">
                                <div className="flex gap-2 mb-3 overflow-x-auto pb-2 scrollbar-hide">
                                    {categories.map(cat => (
                                        <button key={cat.id} 
                                                onClick={() => setNewItem({...newItem, cat: cat.id})}
                                                className={`flex items-center gap-1 px-3 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-all ${newItem.cat === cat.id ? 'bg-[#2F6352] text-white' : 'bg-gray-100 text-gray-500'}`}>
                                            {cat.icon} {cat.label}
                                        </button>
                                    ))}
                                </div>
                                <input type="text" placeholder="ÎÇ¥Ïö© (Ïòà: Ï†êÏã¨ ÎÇôÏßÄÌÉïÌÉïÏù¥)" 
                                    value={newItem.desc} onChange={(e) => setNewItem({...newItem, desc: e.target.value})}
                                    className="w-full p-3 bg-gray-50 rounded-lg mb-2 text-sm outline-none focus:bg-white focus:ring-2 focus:ring-[#2F6352]/20" />
                                <input type="number" placeholder="Í∏àÏï°" 
                                    value={newItem.amount} onChange={(e) => setNewItem({...newItem, amount: e.target.value})}
                                    className="w-full p-3 bg-gray-50 rounded-lg mb-3 text-sm outline-none focus:bg-white focus:ring-2 focus:ring-[#2F6352]/20" />
                                <div className="flex gap-2">
                                    <button onClick={() => setIsAdding(false)} className="flex-1 py-2 bg-gray-100 rounded-lg text-gray-600 text-sm font-bold">Ï∑®ÏÜå</button>
                                    <button onClick={addExpense} className="flex-1 py-2 bg-[#E07D54] text-white rounded-lg text-sm font-bold shadow-md">Ï†ÄÏû•</button>
                                </div>
                            </div>
                        )}

                        <div className="space-y-3">
                            {expenses.length === 0 && !isAdding && (
                                <div className="text-center text-gray-400 mt-10">ÏßÄÏ∂ú ÎÇ¥Ïó≠ÏùÑ Í∏∞Î°ùÌï¥Î≥¥ÏÑ∏Ïöî üí∏</div>
                            )}
                            {expenses.map(item => (
                                <div key={item.firestoreId} className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex justify-between items-center group">
                                    <div className="flex items-center gap-3">
                                        <div className="w-10 h-10 rounded-full bg-[#2F6352]/10 text-[#2F6352] flex items-center justify-center">
                                            {categories.find(c => c.id === item.cat)?.icon || <Wallet size={18}/>}
                                        </div>
                                        <div>
                                            <div className="font-bold text-gray-800">{item.desc}</div>
                                            <div className="text-xs text-gray-400">{item.date} ¬∑ {categories.find(c => c.id === item.cat)?.label}</div>
                                        </div>
                                    </div>
                                    <div className="flex items-center gap-3">
                                        <span className="font-bold text-[#E07D54]">-{item.amount.toLocaleString()}</span>
                                        <button onClick={() => deleteExpense(item.firestoreId)} className="text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity">
                                            <X size={16} />
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const AITab = () => {
            const [messages, setMessages] = useState([
                { role: 'model', text: 'ÏïàÎÖïÌïòÏÑ∏Ïöî! Î™©Ìè¨ Ïó¨Ìñâ AI Í∞ÄÏù¥ÎìúÏûÖÎãàÎã§. üåø\nÎßõÏßë Ï∂îÏ≤ú, ÏΩîÏä§, ÏàôÏÜå Îì± Î¨¥ÏóáÏù¥Îì† Î¨ºÏñ¥Î≥¥ÏÑ∏Ïöî!' }
            ]);
            const [input, setInput] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const scrollRef = useRef(null);

            useEffect(() => {
                const saved = localStorage.getItem('mokpo_ai_chat');
                if (saved) setMessages(JSON.parse(saved));
            }, []);

            useEffect(() => {
                if (scrollRef.current) {
                    scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
                }
                localStorage.setItem('mokpo_ai_chat', JSON.stringify(messages));
            }, [messages]);

            const sendMessage = async () => {
                if (!input.trim()) return;
                
                const userMsg = { role: 'user', text: input };
                setMessages(prev => [...prev, userMsg]);
                setInput('');
                setIsLoading(true);

                const result = await fetchGeminiResponse(input);
                const botText = result || "Ïû†Ïãú Ïó∞Í≤∞Ïù¥ ÏõêÌôúÌïòÏßÄ ÏïäÏïÑÏöî. Ï°∞Í∏à Îí§Ïóê Îã§Ïãú Î¨ºÏñ¥Î¥ê Ï£ºÏÑ∏Ïöî! üò•";
                setMessages(prev => [...prev, { role: 'model', text: botText }]);
                setIsLoading(false);
            };

            return (
                <div className="h-full flex flex-col bg-[#FDFBF6] relative">
                    <div className="p-5 bg-[#2F6352] text-white rounded-b-3xl shadow-md z-10">
                        <h2 className="text-xl font-black flex items-center gap-2">
                            <Sparkles size={20} className="text-[#FFE1A0]" /> Î™©Ìè¨ Ïó¨Ìñâ AI
                        </h2>
                        <p className="text-xs text-emerald-100 opacity-80">GeminiÍ∞Ä Ïó¨Ìñâ Í≥ÑÌöçÏùÑ ÎèÑÏôÄÎìúÎ†§Ïöî</p>
                    </div>

                    <div className="flex-1 overflow-y-auto p-4 space-y-4 pb-20" ref={scrollRef}>
                        {messages.map((msg, idx) => (
                            <div key={idx} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                <div className={`max-w-[80%] p-3 rounded-2xl text-sm leading-relaxed whitespace-pre-wrap shadow-sm ${
                                    msg.role === 'user' 
                                        ? 'bg-[#2F6352] text-white rounded-tr-none' 
                                        : 'bg-white text-gray-800 border border-gray-100 rounded-tl-none'
                                }`}>
                                    {msg.text}
                                </div>
                            </div>
                        ))}
                        {isLoading && (
                            <div className="flex justify-start">
                                <div className="bg-white p-3 rounded-2xl rounded-tl-none shadow-sm border border-gray-100">
                                    <div className="flex gap-1">
                                        <div className="w-2 h-2 bg-[#2F6352] rounded-full animate-bounce"></div>
                                        <div className="w-2 h-2 bg-[#2F6352] rounded-full animate-bounce" style={{animationDelay: '0.2s'}}></div>
                                        <div className="w-2 h-2 bg-[#2F6352] rounded-full animate-bounce" style={{animationDelay: '0.4s'}}></div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>

                    <div className="p-4 bg-white border-t border-gray-100 absolute bottom-0 w-full">
                        <div className="flex gap-2">
                            <input 
                                type="text" 
                                value={input}
                                onChange={(e) => setInput(e.target.value)}
                                onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
                                placeholder="Î™©Ìè¨ ÎßõÏßëÏù¥ÎÇò Í∞àÎßåÌïú Í≥≥ Ï∂îÏ≤úÌï¥Ï§ò!" 
                                className="flex-1 p-3 bg-gray-50 rounded-xl border border-gray-200 focus:bg-white focus:border-[#2F6352] outline-none text-sm"
                            />
                            <button 
                                onClick={sendMessage}
                                disabled={isLoading}
                                className="p-3 bg-[#2F6352] text-white rounded-xl disabled:opacity-50 hover:bg-[#244e40] transition-colors">
                                <Send size={20} />
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('timeline'); 

            return (
                <div className="w-full h-screen bg-gray-100 flex justify-center overflow-hidden font-sans">
                    <div className="w-full max-w-md h-full bg-white shadow-2xl overflow-hidden flex flex-col relative">
                        
                        <div className="flex-1 overflow-hidden relative pb-20">
                            {activeTab === 'timeline' && <TimelineTab />}
                            {activeTab === 'checklist' && <ChecklistTab />}
                            {activeTab === 'budget' && <BudgetTab />}
                            {activeTab === 'ai' && <AITab />}
                        </div>

                        <div className="h-20 bg-white border-t border-gray-100 flex justify-around items-center px-1 pb-2 z-50 absolute bottom-0 w-full">
                            <button onClick={() => setActiveTab('timeline')} 
                                    className={`flex flex-col items-center gap-1 p-1 rounded-xl transition-all w-1/4 ${activeTab === 'timeline' ? 'text-[#2F6352]' : 'text-gray-300'}`}>
                                <div className={`p-1.5 rounded-full ${activeTab === 'timeline' ? 'bg-[#2F6352]/10' : ''}`}>
                                    <Calendar size={20} strokeWidth={activeTab === 'timeline' ? 2.5 : 2} />
                                </div>
                                <span className="text-[9px] font-bold">ÏùºÏ†ï</span>
                            </button>

                            <button onClick={() => setActiveTab('checklist')} 
                                    className={`flex flex-col items-center gap-1 p-1 rounded-xl transition-all w-1/4 ${activeTab === 'checklist' ? 'text-[#2F6352]' : 'text-gray-300'}`}>
                                <div className={`p-1.5 rounded-full ${activeTab === 'checklist' ? 'bg-[#2F6352]/10' : ''}`}>
                                    <CheckSquare size={20} strokeWidth={activeTab === 'checklist' ? 2.5 : 2} />
                                </div>
                                <span className="text-[9px] font-bold">Ï§ÄÎπÑÎ¨º</span>
                            </button>

                            <button onClick={() => setActiveTab('budget')} 
                                    className={`flex flex-col items-center gap-1 p-1 rounded-xl transition-all w-1/4 ${activeTab === 'budget' ? 'text-[#2F6352]' : 'text-gray-300'}`}>
                                <div className={`p-1.5 rounded-full ${activeTab === 'budget' ? 'bg-[#2F6352]/10' : ''}`}>
                                    <Wallet size={20} strokeWidth={activeTab === 'budget' ? 2.5 : 2} />
                                </div>
                                <span className="text-[9px] font-bold">Í∞ÄÍ≥ÑÎ∂Ä</span>
                            </button>

                            <button onClick={() => setActiveTab('ai')} 
                                    className={`flex flex-col items-center gap-1 p-1 rounded-xl transition-all w-1/4 ${activeTab === 'ai' ? 'text-[#2F6352]' : 'text-gray-300'}`}>
                                <div className={`p-1.5 rounded-full ${activeTab === 'ai' ? 'bg-[#2F6352]/10' : ''}`}>
                                    <Sparkles size={20} strokeWidth={activeTab === 'ai' ? 2.5 : 2} />
                                </div>
                                <span className="text-[9px] font-bold">AIÍ∞ÄÏù¥Îìú</span>
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
